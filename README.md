# Marioshka — 2D платформер в стиле Super Mario

## Установка и сборка

1. Склонируйте репозиторий:  
   ```bash
   git clone https://github.com/luxurycocacola/mario3.git
2. Откройте проект в Visual Studio.
3. Соберите и запустите проект.

## Описание проекта

Marioshka — учебный 2D-платформер, созданный на C++ с использованием WinAPI.  
Игра вдохновлена классическим Super Mario и демонстрирует основы создания игр: анимацию, физику столкновений, управление персонажем.

## Демонстрация

[Смотреть видео на YouTube](https://youtube.com/your-demo-video-link)  

## Технологии и особенности

- Язык: C++  
- Используется WinAPI для рендеринга и обработки событий  
- Собственная система анимации и физики  
- Управление клавиатурой (AWD, пробел, ESC)  
- Работа с ресурсами: спрайты, шрифты, карта 
- Камера, следящая за персонажем  

## Характерные моменты проекта

- Реализована физика столкновений с тайлами карты  
- Управление анимацией спрайтов и их синхронизация с действиями  
- Использование bitmap-изображений для карты и спрайтов   

## Техническое описание

### 1. `Animation.cpp / Animation.h`
**Назначение:**  
Реализует модуль покадровой анимации с циклическим воспроизведением на базе SFML.

**Ключевые компоненты:**

- **`AnimFrame`** — структура, описывающая один кадр анимации:
  - `time` — время, в которое должен отображаться кадр.
  - `texture` — текстура кадра (`sf::Texture`).

- **`Animation`** — основной класс для управления анимацией:
  - `Animation(float lenght, std::vector<AnimFrame> frames)` — конструктор с параметрами: общая длина анимации и список кадров.
  - `void Update(float deltaTime)` — обновляет текущее время анимации.
  - `sf::Texture GetTexture()` — возвращает текстуру текущего кадра, соответствующую текущему времени.

---

### 2. `Camera.cpp / Camera.h`
**Назначение:**  
Реализует модуль камеры с поддержкой масштабирования и сохранением правильного соотношения сторон при изменении размеров окна. Обеспечивает отдельные виды для игровой сцены и пользовательского интерфейса на базе SFML.

**Ключевые компоненты:**

- **`Camera`** — основной класс для управления виртуальной камерой:
  - `Camera(float zoomLevel = 5.0f)` — конструктор, задающий масштаб камеры.
  - `sf::Vector2f GetViewSize()` — возвращает текущий размер области обзора камеры.
  - `sf::View GetView(sf::Vector2u windowSize)` — возвращает `sf::View` с учётом масштаба и соотношения сторон окна для основной сцены.
  - `sf::View GetUIView()` — возвращает `sf::View` для пользовательского интерфейса с фиксированной высотой и сохранением пропорций.
 
 ---

### 3. `Coin.cpp / Coin.h`
**Назначение:**  
Реализует игровой объект "монета", который отображается с анимацией и имеет физическое тело для взаимодействия. Используется для сбора предметов в игровой сцене.

**Ключевые компоненты:**

- **`Coin`** — класс объекта монеты, наследующийся от `Object`:
  - `~Coin()` — деструктор, удаляющий физическое тело из физического мира Box2D.
  - `void Begin() override` — инициализирует анимацию монеты, создаёт физическое тело и настраивает его как сенсор.
  - `void Update(float deltaTime) override` — обновляет текущую анимацию монеты.
  - `void Render(Renderer& renderer) override` — отрисовывает текущий кадр анимации монеты с заданным масштабом.

---

### 4. `Enemy.cpp / Enemy.h`
**Назначение:**  
Реализует игровой объект "враг" с анимацией, физическим телом и базовым поведением движения и смерти.

**Ключевые компоненты:**

- **`Enemy`** — класс врага, наследующийся от `Object`:
  - `void Begin() override` — инициализирует анимацию, физическое тело с формой круга и устанавливает начальные параметры.
  - `void Update(float deltaTime) override` — обновляет анимацию, управляет движением врага, изменяя направление при столкновениях, и обрабатывает логику смерти и удаления.
  - `void Render(Renderer& renderer) override` — отрисовывает врага, изменяя масштаб и позицию, если враг мёртв.
  - `void Die()` — переводит врага в состояние смерти, запускает таймер уничтожения.

---

### 6. `Map.cpp / Map.h`

**Назначение:**  
Обеспечивает создание и отображение игрового уровня в виде сетки из тайлов и объектов. Поддерживает генерацию карты по изображению с различными типами объектов.

**Ключевые компоненты:**

- **`Map`** — класс для генерации карты:
  - `Map(float cellSize = 32.0f)` — конструктор, задающий размер одной ячейки сетки.
  - `void CreateCheckerboard(size_t width, size_t height)` — создаёт шахматный узор из тайлов.
  - `sf::Vector2f CreateFromImage(const sf::Image& image, std::vector<Object*>& objects)` — генерирует карту по пикселям изображения, создавая объекты и физические тела в зависимости от цвета пикселя. Возвращает стартовую позицию игрока.
  - `void Draw(Renderer& renderer)` — отрисовывает все тайлы карты с учётом размера ячейки.

---

### 7. `Mario.cpp / Mario.h`
**Назначение:**  
Реализует игрового персонажа Марио с управлением движением, прыжками, анимацией и обработкой столкновений.

**Ключевые компоненты:**

- **`Mario`** — класс игрового персонажа:
  - `Begin()` — инициализация физического тела и анимаций персонажа.
  - `Update(float deltaTime)` — обработка управления (движение, прыжок), обновление состояния и анимации.
  - `Draw(Renderer& renderer)` — отрисовка персонажа с учётом направления и угла.
  - `OnBeginContact(b2Fixture* self, b2Fixture* other)` — обработка начала контакта с землей, монетами и врагами.
  - `OnEndContact(b2Fixture* self, b2Fixture* other)` — обработка окончания контакта с землей.
  - `GetCoins()` — возвращает количество собранных монет.

---

### 9. `Object.h`

**Назначение:**  
Базовый класс для всех игровых объектов, обеспечивающий интерфейс для инициализации, обновления и отрисовки, а также хранение основных свойств объекта.

**Ключевые компоненты:**

- **`Object`** — базовый класс для игровых объектов:
  - `Begin()` — виртуальный метод инициализации.
  - `Update(float deltaTime)` — виртуальный метод обновления состояния объекта.
  - `Render(Renderer& renderer)` — виртуальный метод для отрисовки объекта.
  - `tag` — строковый идентификатор типа объекта.
  - `position` — позиция объекта в игровом мире.
  - `angle` — угол поворота объекта.

---

### 10. `Physics.cpp / Physics.h`
**Назначение:**  
Реализация физики движения и проверки столкновений.

**Ключевые компоненты:**
- **`MyDebugDraw`** — класс-наследник b2Draw для визуализации тел и форм физического мира через SFML:
  - Рисует полигоны, окружности, линии и трансформации.
  - Используется для отладки и визуального контроля физики.
- **`ContactListenert`** — интерфейс для обработки событий столкновений:
  - `OnBeginContact(b2Fixture* self, b2Fixture* other)` — вызывается при начале контакта.
  - `OnEndContact(b2Fixture* self, b2Fixture* other)` — вызывается при окончании контакта.
- **`MyGlobalContactListener`** — глобальный слушатель коллизий, который перенаправляет события начала и конца контактов соответствующим объектам через интерфейс ContactListener.
- **`FixtureDataType`** — перечисление типов фикстур, используемых для идентификации объектов:
  - `Mario` — персонаж Марио.
  - `MapTile` — тайл карты.
  - `Object` — игровой объект.
- **`FixtureData`** — структура, хранящая данные о физическом объекте:
  - type — тип фикстуры из FixtureDataType.
  - listener — указатель на обработчик коллизий (наследник ContactListener).
  - В union хранится ссылка на конкретный объект (Mario*, Object*) и координаты тайла карты.
- **`Physics`** — класс, управляющий физическим миром Box2D:
  - `Init()` — инициализация физического мира с гравитацией.
  - `Update(float deltaTime)` — обновление физического мира и обработка контактов.
  - `DebugDraw(Renderer& renderer)` — отладочная отрисовка физических тел с помощью SFML.
  - Статические поля: world — указатель на физический мир, debugDraw — объект отладочной отрисовки.

---

### 11. `Renderer.cpp / Renderer.h`
**Назначение:**  
Обработка и оптимизация отрисовки графики.

**Ключевые компоненты:**
- **`Renderer`** — основной класс для управления отрисовкой:
  - Renderer(sf::RenderTarget& target) — конструктор, принимает ссылку на RenderWindow или другой RenderTarget, куда будет вестись отрисовка.
  - Draw(...) — метод отрисовки текстуры с заданной позицией, масштабом и углом поворота.
  - target — ссылка на текущий RenderTarget, в котором происходит рисование.
---

### 12. `Resources.cpp / Resources.h`
**Назначение:**  
Загрузка и управление ресурсами.

**Ключевые компоненты:**
- **`Resources`** — статический класс-менеджер ресурсов:
  - static std::unordered_map<std::string, sf::Texture> textures — контейнер для хранения текстур, доступ к которым осуществляется по строковому имени.
---

### 13. `Game.cpp / Game.h`
**Назначение:**
Определяет основную игровую логику, обработку состояний, загрузку ресурсов, обновление объектов и отрисовку сцены. Связывает все компоненты игры воедино (игрока, карту, физику, интерфейс).

**Ключевые компоненты:**
- **`Camera camera`** — игровая камера, используется для позиционирования сцены.
- **`bool paused`** — флаг паузы.
- **`Begin(const sf::Window& window)`** — загружает ресурсы (текстуры, шрифт, карту), инициализирует физику и запускает игру с нуля.
- **`Update(float deltaTime)`** — обрабатывает основную игровую логику:
  - Перезапуск игры при смерти персонажа.
  - Обновление физики, камеры и объектов.
- **`Render(Renderer& renderer)`** — отрисовка заднего фона, карты, объектов, персонажа и графики физики.
- **`RenderUI(Renderer& renderer)`** — рендер пользовательского интерфейса:
  - Счётчик монет.
  - Экран "Game Over" и подсказка перезапуска при смерти персонажа.
- **`DeleteObject(Object* object)`** — удаляет объект из игрового мира и освобождает память.
---

### 14. `main.cpp`
**Назначение:**  
Точка входа программы, создание окна, запуск игрового цикла.

**Ключевые компоненты:**
- **`sf::RenderWindow window(...)`** — инициализация главного окна с заданным разрешением и заголовком "Mario".
- **`window.setFramerateLimit(60)`** — установка максимальной частоты кадров.
- **`while (window.isOpen())`** — основной цикл, работающий пока окно активно.
  - Обработка времени через deltaClock.restart().asSeconds() для обеспечения независимости от FPS.
  - События клавиатуры:
    - Закрытие окна.
    - Пауза по нажатию Esc.
- **`Begin(window)`** — инициализация игры.
- **`Update(deltaTime)`** — обновление логики игры.
- **`Render(renderer)`** — отрисовка мира.
- **`RenderUI(renderer)`** — отрисовка интерфейса.
- **`window.display()`** — отображение всего, что было нарисовано в кадре.
---
